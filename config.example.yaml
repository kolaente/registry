# Example configuration for Docker Registry
# Copy this file to config.yaml and customize as needed

server:
  # Address to listen on
  # NOTE: This registry only supports HTTP. For TLS/HTTPS, use a reverse proxy
  # like Traefik, nginx, or Caddy (see docker-compose.traefik.yml for example)
  addr: ":5000"

# User accounts with bcrypt-hashed passwords
# Generate with: htpasswd -nbBC 10 username password
users:
  # Username: admin, Password: password
  admin:
    password: "$2y$10$wGmIgzScW7ExkU6gPeNr9.KwmiwF3vnJ3IPasImRAr38i/TXZqloO"

  # Username: developer, Password: devpass
  developer:
    password: "$2y$10$rcZ1nX25EHturNDkCofPsej2UsSkHnLzMyGLdbULyevuhKj/p.gEa"

# Access Control List (ACL) rules
# Rules are evaluated in order; first match wins
# Available actions: pull, push, delete, or * (for all actions)
acl:
  # Admin has full access to all repositories (including delete)
  - account: "admin"
    name: "*"
    actions: ["*"]

  # Developer can push and pull to backend-* repositories
  - account: "developer"
    name: "myorg/backend-*"
    actions: ["pull", "push"]

  # Developer can only pull from frontend repository
  - account: "developer"
    name: "myorg/frontend"
    actions: ["pull"]

  # Example: read-only access for a user
  # - account: "readonly"
  #   name: "myorg/*"
  #   actions: ["pull"]

  # Example: allow a user to delete images from a specific repository
  # - account: "cleaner"
  #   name: "myorg/temp-*"
  #   actions: ["delete"]

# Storage configuration
# Choose either filesystem or s3 storage (not both)
storage:
  filesystem:
    # Directory where images will be stored
    rootdirectory: "/data/registry"

  # S3-compatible storage (uncomment to use instead of filesystem)
  # s3:
  #   accesskey: "your-access-key"
  #   secretkey: "your-secret-key"
  #   region: "us-east-1"
  #   regionendpoint: ""          # Custom endpoint for S3-compatible services (e.g., MinIO)
  #   bucket: "your-bucket-name"
  #   rootdirectory: ""           # Optional prefix for all objects
  #   encrypt: false              # Enable server-side encryption
  #   secure: true                # Use HTTPS for S3 connections

# Authentication settings
auth:
  realm: "Registry"
  service: "Docker Registry"
  issuer: "registry-auth-server"

  # HMAC secret for JWT signing
  # Generate a strong secret with: openssl rand -base64 32
  hmac_secret: "your-secret-key-here"

# Rate limiting configuration
rate_limit:
  enabled: true
  requests_per_sec: 10  # Requests per second per IP address
  burst: 20             # Maximum burst size (allows temporary spikes)

# Garbage collection configuration
# Automatically cleans up unreferenced layers and optionally untagged manifests
garbage_collector:
  enabled: false        # Enable automatic garbage collection
  interval: "24h"       # How often to run garbage collection (e.g., "24h", "1h30m")
  remove_untagged: true # Remove manifests that are not referenced by any tag
